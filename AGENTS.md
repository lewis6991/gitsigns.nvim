# Repository Guidelines

## Project Structure & Module Organization
Core Lua modules live in `lua/gitsigns/` (config, handlers, utilities) and should stay pure so specs can require them directly.
User-facing commands and autocmds are wired in `plugin/gitsigns.vim`, while help files under `doc/` get regenerated by `gen_help.lua`.
Specs plus fixtures sit in `test/`, relying on helpers in `test/gs_helpers.lua`.
Tooling binaries (Stylua, nvim-test, EmmyLua) are cached in `deps/`.

## Build, Test, and Development Commands
- `make build`: run Stylua over `lua/` + `test/`, then regenerate help files before committing.
- `make test [FILTER=pattern]`: execute the functional suite via nvim-test with the default Neovim runner.
- `make test-010`, `make test-011`, `make test-nightly`: confirm compatibility with multiple Neovim versions.
- `make doc` / `make doc-check`: regenerate help from `lua/gitsigns/config.lua` and fail if docs drift.
- `make stylua-check` or `make stylua-run`: lint or autoformat Lua sources.
- `make emmylua-check`: run optional static analysis after fetching the analyzer.

## Coding Style & Naming Conventions
Stylua enforces 2-space indentation, 100-character columns, Unix line endings, and `auto_prefer_single` quotes (`.stylua.toml`).
Public modules export tables named after their file (e.g., `require('gitsigns.diff')`); local helpers stay snake_case.
Keep API naming aligned with existing commands (`setup`, `attach`, `preview_hunk`) and prefer keyed tables over positional args.
Wrap Neovim APIs in utility functions when tests need to mock them, and run `make stylua-run` before pushing.

## Testing Guidelines
Specs reside in `test/*_spec.lua` and run under the `nvim-test` harness, which provisions a headless Neovim plus RPC helpers.
Every bug fix must include a spec that reproduces the regression and asserts the desired buffer state, co-located with related modules (for example, `hunk_spec.lua` for hunk logic).
Use `test/gs_helpers.lua` utilities instead of shelling out to Git, and reset repo fixtures between assertions.
Keep tests deterministic by guarding optional Git features and running the version matrix (`make test-010 && make test-nightly`) when Neovim internals are touched.

## Commit & Pull Request Guidelines
History follows a lightweight Conventional Commit style: `<type>(<scope>): <verb phrase>` (for instance, `fix(blame): close blame window on bufhidden`), so match that pattern and keep subjects under 72 characters.
Each PR should recap the bug, list manual or automated verification, link upstream issues, and mention doc help updates when behavior changes.
Ensure `make build`, the relevant `make test-*`, and `make doc-check` all pass locally.
